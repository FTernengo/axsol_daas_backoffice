<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Cliente - AXSOL DaaS</title>
    <!-- Fix: Correct paths to CSS files and add Bootstrap CDN + Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../../assets/css/styles.css">
</head>
<body>
    <!-- Incluir header -->
    <div id="header-container"></div>

    <div class="container-fluid">
        <div class="row">
            <!-- Incluir sidebar -->
            <div id="sidebar-container" class="col-md-3 col-lg-2 d-md-block sidebar"></div>

            <!-- Contenido principal -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2" id="form-title">Nuevo Cliente</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <a href="clientes.html" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Volver
                        </a>
                    </div>
                </div>

                <!-- Contenedor de alertas -->
                <div id="alertsContainer"></div>

                <!-- Formulario de cliente -->
                <div class="card">
                    <div class="card-body">
                        <form id="cliente-form" class="needs-validation" novalidate>
                            <input type="hidden" id="cliente-id">
                            
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="nombre" class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="nombre" required>
                                    <div class="invalid-feedback">
                                        El nombre es obligatorio.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="contacto" class="form-label">Contacto</label>
                                    <input type="text" class="form-control" id="contacto" required>
                                    <div class="invalid-feedback">
                                        El contacto es obligatorio.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" required>
                                    <div class="invalid-feedback">
                                        Ingrese un email válido.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="estado" class="form-label">Estado</label>
                                    <select class="form-select" id="estado" required>
                                        <option value="">Seleccione...</option>
                                        <option value="Activo">Activo</option>
                                        <option value="Inactivo">Inactivo</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Seleccione un estado.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="button" class="btn btn-secondary" onclick="cancelForm()">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Guardar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Incluir footer -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <!-- Fix: Correct paths to JS files - using relative paths without leading slash -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/mock-data.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script>
        // Cargar componentes
        document.addEventListener('DOMContentLoaded', function() {
            // Fix: Use relative paths for component loading
            // Cargar componentes HTML
            fetch('../../components/header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-container').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading header:', error);
                    document.getElementById('header-container').innerHTML = '<div class="alert alert-danger">Error loading header component</div>';
                });

            fetch('../../components/sidebar.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('sidebar-container').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading sidebar:', error);
                    document.getElementById('sidebar-container').innerHTML = '<div class="alert alert-danger">Error loading sidebar component</div>';
                });

            fetch('../../components/footer.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('footer-container').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading footer:', error);
                    document.getElementById('footer-container').innerHTML = '<div class="alert alert-danger">Error loading footer component</div>';
                });

            // Configurar formulario
            const clienteId = Utils.getUrlParam('id');
            if (clienteId) {
                // Modo edición
                document.getElementById('form-title').textContent = 'Editar Cliente';
                loadClienteData(clienteId);
            }

            // Configurar evento submit
            document.getElementById('cliente-form').addEventListener('submit', handleSubmit);
        });

        // Cargar datos del cliente para edición
        function loadClienteData(id) {
            const cliente = DataService.getById('clientes', id);
            if (!cliente) {
                Utils.showNotification('Cliente no encontrado', 'danger');
                setTimeout(() => Utils.redirect('clientes.html'), 2000);
                return;
            }

            document.getElementById('cliente-id').value = cliente.id;
            document.getElementById('nombre').value = cliente.nombre;
            document.getElementById('contacto').value = cliente.contacto;
            document.getElementById('email').value = cliente.email;
            document.getElementById('estado').value = cliente.estado;
        }

                // Manejar envío del formulario
        function handleSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            if (!Utils.validateForm(form)) {
                Utils.showValidationErrors(form);
                return;
            }
            
            // Recopilar datos del formulario
            const clienteData = {
                id: document.getElementById('cliente-id').value || null,
                nombre: document.getElementById('nombre').value,
                contacto: document.getElementById('contacto').value,
                email: document.getElementById('email').value,
                estado: document.getElementById('estado').value
            };
            
            // Guardar cliente
            try {
                const savedCliente = DataService.save('clientes', clienteData);
                Utils.showNotification('Cliente guardado correctamente', 'success');
                setTimeout(() => Utils.redirect('clientes.html'), 1500);
            } catch (error) {
                Utils.showNotification(`Error al guardar el cliente: ${error.message}`, 'danger');
            }
        }
        
        // Cancelar formulario
        function cancelForm() {
            Utils.redirect('clientes.html');
        }